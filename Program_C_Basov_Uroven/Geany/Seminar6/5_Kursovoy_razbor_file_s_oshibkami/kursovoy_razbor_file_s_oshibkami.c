/*
//-----------------------------------------------------------------------
Пояснения:
//-----------------------------------------------------------------------
Программа открывает CSV-файл и построчно читает данные, ожидая 6 числовых полей, 
разделённых точкой с запятой.
Если в строке есть ошибка (например, не число, как
-xx
), программа выводит сообщение об ошибке и остаток строки.
Если строка корректна, выводит все считанные значения.
//-----------------------------------------------------------------------
*/

#include <stdio.h>  // Для функций работы с файлами и ввода-вывода

int main(int argc, char **argv)
{
    FILE *open;                                 // Указатель на файл
    char name[] = "temperature_small1.csv";     // Имя файла с данными

    open = fopen(name, "r");                    // Открываем файл для чтения
    if(open == NULL)                            // Если файл не открылся — выходим
        return 1;

    int Y, M, D, H, m, T, n_scan;               // Переменные для хранения данных и количества считанных полей

    // Читаем файл построчно, пока fscanf успешно считывает хотя бы одно поле
    while((n_scan = fscanf(open, "%d;%d;%d;%d;%d;%d", &Y, &M, &D, &H, &m, &T)) > 0)
    {
        if (n_scan < 6)                         // Если считано меньше 6 полей — ошибка в строке
        {
            char s[20], c;                      // Буфер для остатка строки и символ новой строки
            n_scan = fscanf(open, "%[^\n]%c", s, &c); // Считываем остаток строки до конца строки
            printf("Wrong format in line %s\n", s);    // Сообщаем об ошибке и выводим остаток строки
        }
        else
            // Если считано 6 полей — выводим их
            printf("%d = %d;%d;%d;%d;%d;%d\n", n_scan, Y, M, D, H, m, T);
    }
    fclose(open);                               // Закрываем файл
    return 0;                                   // Завершаем программу
}