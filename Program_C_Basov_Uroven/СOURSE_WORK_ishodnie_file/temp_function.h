#ifndef TEMP_API_H
#define TEMP_API_H

#include <stdlib.h>
#include <inttypes.h>

#define SIZE  600000   // Размер массива для хранения записей из CSV (запас по количеству)

//-----------------------------------------------------------------
// Переопределим типы для удобства
//-----------------------------------------------------------------
typedef struct sensor sensor_t;
//typedef struct data   data_t;   // В ТЕКУЩЕЙ ВЕРСИИ data_t не используется (см. ниже)

//-----------------------------------------------------------------
// Структура sensor
// Описывает одно измерение датчика температуры:
//  - дата (год, месяц, день),
//  - время (часы, минуты),
//  - измеренная температура.
//-----------------------------------------------------------------
typedef struct sensor
{
    // Лучше начинать с самых "широких" полей (для выравнивания структуры)
    uint16_t year;    // год
    uint8_t  month;   // месяц
    uint8_t  day;     // день
    uint8_t  watch;   // часы
    uint8_t  minutes; // минуты
    int8_t   t;       // температура
} sensor_t;

//-----------------------------------------------------------------
// Структура data – массив измерений + количество
// В ТЕКУЩЕЙ ВЕРСИИ ПРОГРАММЫ НЕ ИСПОЛЬЗУЕТСЯ,
// оставлена для возможного расширения (например, при работе с бинарными файлами).
/*
typedef struct data
{
    uint32_t number;      // количество элементов в массиве info[]
    sensor_t info[SIZE];  // массив измерений
} data_t;
*/
//--------------------------------------------------------------------
// Базовые функции сортировки (СЕЙЧАС НЕ ИСПОЛЬЗУЮТСЯ В ОСНОВНОЙ ЛОГИКЕ)
// Оставлены закомментированными как задел для расширения функционала.
//--------------------------------------------------------------------
/*
void cgangeIJ(sensor_t info[], int i, int j);

// сортировки (по температуре и по дате)
void SortByT(sensor_t info[], int n);
unsigned int DateToInt(sensor_t info[]);
int  Compare(const void *va, const void *vb);
void SortByDate(sensor_t info[], int n);
*/

//--------------------------------------------------------------------
// Загрузка CSV
//--------------------------------------------------------------------
// Загрузка CSV-файла в массив info[].
// На вход подаём:
//  - info[]   – массив структур для заполнения,
//  - max_n    – максимальное количество элементов (обычно SIZE),
//  - filename – имя файла CSV.
// Возвращает количество корректно загруженных записей.
// При ошибке формата строки выводится сообщение, а строка не учитывается.
//--------------------------------------------------------------------
int load_temperature_csv(sensor_t info[], int max_n, const char *filename);

//--------------------------------------------------------------------
// Статистика по месяцу и году (вычисление и печать)
//--------------------------------------------------------------------

//--------------------------------------------------------------------
// Статистика по месяцу (ПЕЧАТАЮЩИЕ ФУНКЦИИ, В ТЕКУЩЕЙ ВЕРСИИ НЕ ВЫЗЫВАЮТСЯ)
// Оставлены закомментированными как альтернативный интерфейс.
//--------------------------------------------------------------------
/*
void SortBy_Аverage_monthly__T(sensor_t info[], int n, int year, int month);
void SortBy_min_T_in_the_current_month(sensor_t info[], int n, int year, int month);
void SortBy_max_T_in_the_current_month(sensor_t info[], int n, int year, int month);
*/
void print_shap_zagolovka();
//--------------------------------------------------------------------
// Статистика за год (печатающие функции).
// Используются в конце таблицы для вывода сводной информации:
//  - среднегодовая температура,
//  - минимальная за год,
//  - максимальная за год.
//--------------------------------------------------------------------
void SortBy_Average_year__T(sensor_t info[], int n, int year);
void SortBy_min_T_for_the_year(sensor_t info[], int n, int year);
void SortBy_max_T_for_the_year(sensor_t info[], int n, int year);

//--------------------------------------------------------------------
// "Тихая" статистика по месяцу – только вычисляет значения,
// без вывода на экран.
// Используется функцией print_month_stat_line().
//--------------------------------------------------------------------
int get_month_stats(sensor_t info[], int n, int year, int month,
                    int *min_t, int *max_t, double *avg_t);

//--------------------------------------------------------------------
// Печать одной строки таблицы по месяцу.
// Формат строки соответствует заголовку таблицы в report.c.
//--------------------------------------------------------------------
int print_month_stat_line(sensor_t info[], int n,
                          int year, int month, int line_no);

//--------------------------------------------------------------------
// Печать таблицы по всем месяцам + сводка по году.
// Выводит:
//  - заголовок таблицы;
//  - строки по месяцам, для которых есть данные;
//  - сводную годовую статистику (средняя, min, max).
//--------------------------------------------------------------------
void print_year_table(sensor_t info[], int n, int year);

#endif // TEMP_API_H