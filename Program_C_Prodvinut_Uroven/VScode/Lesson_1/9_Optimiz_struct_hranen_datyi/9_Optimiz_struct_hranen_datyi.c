//--------------------------------------------------------
//         Пример оптимизации структуры для хранения даты
//--------------------------------------------------------
//-----------------------------------------------------------------
// Здесь пример того, как с помощью битовых полей можно уменьшить
// размер структуры для хранения простой даты (день, месяц, год).
//-----------------------------------------------------------------

#include <stdio.h>
#include <stdint.h>

// Описание структуры date с битовыми полями
struct date 
{
    // Вариант с uint32_t (закомментирован в примере):
    // при таком описании компилятор обычно выровняет структуру
    // до 4 байт или больше (часто 8 из-за выравнивания/паддинга).
    //
    // uint32_t day   : 5; // 0..31 — достаточно 5 бит
    // uint32_t month : 4; // 0..15 — достаточно 4 бит
    // uint32_t year;      // полное 32-битное поле под год

    // Вариант с uint16_t:
    // Все битовые поля основаны на uint16_t, и суммарно укладываются
    // в 16 бит (2 байта), поэтому размер структуры — 2 байта.
    //
    // day:   5 бит  → 0..31 (дней в месяце максимум 31)
    // month: 4 бита → 0..15 (достаточно для 1..12)
    // year:  7 бит  → 0..127 значений
    //
    // Если интерпретировать year как "смещение от 2000 года",
    // то диапазон лет: 2000..2127.
    uint16_t day   : 5; // значение от 0 до 31
    uint16_t month : 4; // значение от 0 до 15 (1..12)
    uint16_t year  : 7; // 0..127 → храним год как (год - 2000)
};

int main()
{
    // Инициализируем структуру датой:
    // day = 29, month = 1, year = 26 (будем трактовать как 2000 + 26 = 2026).
    //
    // Порядок инициализации соответствует порядку полей:
    // { day, month, year }
    struct date dt = { 29, 01, 26 };

    // Выводим размер структуры в байтах.
    // Ожидаемо: Size is 2 (два байта на все три поля).
    printf("Size is %lu\n", sizeof(dt));

    // При выводе года восстанавливаем полный год:
    // храним 26 → выводим 2000 + 26 = 2026.
    //Внимание! Если вы зададите значение, которое не помещается в поле с
    //данным размером, то оно будет сохранено с ошибкой(храним 2026 вместо 26).
    //Внимание! В языке Си нет возможности создать структуру вида побитовый
    //массив.
    printf("Date is %u/%u/%u\n", dt.day, dt.month, 2000 + dt.year);

    return 0;
}
//Кратко по идее программы:
//Используем битовые поля, чтобы «упаковать» день, месяц и год в 16 бит.
//Ограничиваем диапазон годов (2000–2127), чтобы уложиться в 7 бит.
//За счёт этого sizeof(struct date) становится 2 байта вместо 4 или 8.