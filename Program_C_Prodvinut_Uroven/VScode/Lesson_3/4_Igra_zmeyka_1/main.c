/*
//------------------------------------------------------
//       –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏
//------------------------------------------------------
–°–ª–µ–¥—É—é—â–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–º–∏–Ω–∞—Ä–æ–≤ –±—É–¥–µ—Ç –ø–æ—Å–≤—è—â–µ–Ω—ã –ø—Ä–æ–µ–∫—Ç—É ¬´–°–∏—Å—Ç–µ–º—ã
—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è¬ª.
üêç –†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –µ–≥–æ –º—ã –±—É–¥–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω–æ –Ω–∞ –º–∏–Ω–∏-–∏–≥—Ä–µ ¬´–ó–º–µ–π–∫–∞¬ª,
—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–æ—Ç–æ—Ä–æ–π —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º —Å —Ä–∞–±–æ—Ç–æ–π —Å–µ–ª—å—Å–∫–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥—Ä–æ–Ω–æ–≤,
—Ä–æ–±–æ—Ç–æ–≤ –ø—ã–ª–µ—Å–æ—Å–æ–≤ –∏ —Ç.–ø..
üêç –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å—Ö–æ–∂–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Å–±–æ—Ä–∞, –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞–¥–∞—á–∏
—Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.
//------------------------------------------------------
// –ü–ª–∞–Ω —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ç–µ–∫—É—â—É—é –ª–µ–∫—Ü–∏—é
//------------------------------------------------------
üêç –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
üêç –û–ø–∏—Å–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏–≥—Ä—ã (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
üêç –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏—à —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏–µ–º
üêç –ê–ª–≥–æ—Ä–∏—Ç–º—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü (—Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∑–º–µ–π–∫–∏)
...
*/

#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <ncurses.h>   // –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ncurses –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
#include <inttypes.h>
#include <string.h>
#include <unistd.h>

//------------------------------------------------------
// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è
//------------------------------------------------------
#define MIN_Y 2   // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ç–∏—Ä–∞—Ç—å —Å—Ç—Ä–æ–∫—É –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å–≤–µ—Ä—Ö—É)

// –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–≤–∏–∂–µ–Ω–∏—è –∑–º–µ–π–∫–∏ –∏ –∫–æ–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–≥—Ä—ã
// STOP_GAME = –∫–ª–∞–≤–∏—à–∞ F10 (–º–∞–∫—Ä–æ—Å ncurses KEY_F(10))
enum {LEFT=1, UP, RIGHT, DOWN, STOP_GAME=KEY_F(10)};

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ —Ö–≤–æ—Å—Ç–∞ –∏ –µ–¥–æ–π
enum {
    MAX_TAIL_SIZE       = 100,  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ö–≤–æ—Å—Ç–∞
    START_TAIL_SIZE     = 3,    // –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ö–≤–æ—Å—Ç–∞
    MAX_FOOD            = 20,   // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥—ã (–Ω–∞ –±—É–¥—É—â–µ–µ)
    FOOD_EXPIRE_SECONDS = 10    // –í—Ä–µ–º—è "–∂–∏–∑–Ω–∏" –µ–¥—ã (–Ω–∞ –±—É–¥—É—â–µ–µ)
};

//------------------------------------------------------
// –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–º–µ–π–∫–∏
//------------------------------------------------------
/*
–ö–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–º–µ–π–∫–æ–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ control_buttons.
–ó–¥–µ—Å—å –∑–∞–¥–∞—ë–º, –Ω–∞ –∫–∞–∫–∏–µ –∫–ª–∞–≤–∏—à–∏ (–∫–æ–¥—ã ncurses) —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å:
–≤–≤–µ—Ä—Ö, –≤–Ω–∏–∑, –≤–ª–µ–≤–æ, –≤–ø—Ä–∞–≤–æ.
*/
struct control_buttons {
    int down;
    int up;
    int left;
    int right;
} control_buttons;

// –ù–∞–±–æ—Ä –∫–Ω–æ–ø–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —Å—Ç—Ä–µ–ª–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
struct control_buttons default_controls = {
    KEY_DOWN,
    KEY_UP,
    KEY_LEFT,
    KEY_RIGHT
};

/*
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ snake_t ‚Äî "–≥–æ–ª–æ–≤–∞" –∑–º–µ–π–∫–∏ –∏ —Å–≤—è–∑—å —Å —Ö–≤–æ—Å—Ç–æ–º:
- x, y        ‚Äî —Ç–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ–ª–æ–≤—ã
- direction   ‚Äî –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è (LEFT, RIGHT, UP, DOWN)
- tsize       ‚Äî —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä —Ö–≤–æ—Å—Ç–∞
- *tail       ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –º–∞—Å—Å–∏–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ö–≤–æ—Å—Ç–∞
- controls    ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫–ª–∞–≤–∏—à —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
*/
typedef struct snake_t {
    int x;
    int y;
    int direction;
    size_t tsize;
    struct tail_t *tail;
    struct control_buttons controls;
} snake_t;

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ tail_t ‚Äî –æ–¥–∏–Ω —Å–µ–≥–º–µ–Ω—Ç —Ö–≤–æ—Å—Ç–∞ (–ø—Ä–æ—Å—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã x, y)
typedef struct tail_t {
    int x;
    int y;
} tail_t;

//------------------------------------------------------
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö–≤–æ—Å—Ç–∞ –∏ –≥–æ–ª–æ–≤—ã –∑–º–µ–π–∫–∏
//------------------------------------------------------
/*
–§—É–Ω–∫—Ü–∏—è initTail:
–∑–∞–ø–æ–ª–Ω—è–µ—Ç –º–∞—Å—Å–∏–≤ —Ö–≤–æ—Å—Ç–∞ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ (0,0) –¥–ª—è –≤—Å–µ—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤.
*/
void initTail(tail_t t[], size_t size)
{
    struct tail_t init_t = {0, 0};
    for (size_t i = 0; i < size; i++)
    {
        t[i] = init_t;
    }
}

/*
–§—É–Ω–∫—Ü–∏—è initHead:
–∑–∞–¥–∞—ë—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ–ª–æ–≤—ã –∏ –Ω–∞—á–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è.
*/
void initHead(snake_t *head, int x, int y)
{
    head->x = x;
    head->y = y;
    head->direction = RIGHT;   // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ
}

/*
–§—É–Ω–∫—Ü–∏—è initSnake:
–ø–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–º–µ–π–∫–∏:
- –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –ø–∞–º—è—Ç—å –ø–æ–¥ –º–∞—Å—Å–∏–≤ —Ö–≤–æ—Å—Ç–∞
- —Ö–≤–æ—Å—Ç –æ–±–Ω—É–ª—è–µ—Ç—Å—è
- –∑–∞–¥–∞—é—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ–≤—ã
- –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
*/
void initSnake(snake_t *head, size_t size, int x, int y)
{
    // –í—ã–¥–µ–ª—è–µ–º –ø–∞–º—è—Ç—å –ø–æ–¥ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ö–≤–æ—Å—Ç
    tail_t* tail = (tail_t*) malloc(MAX_TAIL_SIZE * sizeof(tail_t));

    // –û–±–Ω—É–ª—è–µ–º –≤—Å–µ —Å–µ–≥–º–µ–Ω—Ç—ã —Ö–≤–æ—Å—Ç–∞
    initTail(tail, MAX_TAIL_SIZE);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥–æ–ª–æ–≤—É
    initHead(head, x, y);

    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Ö–≤–æ—Å—Ç –∫ –≥–æ–ª–æ–≤–µ
    head->tail = tail;
    head->tsize = size + 1;         // +1 ‚Äî —Å —É—á—ë—Ç–æ–º –≥–æ–ª–æ–≤—ã (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ª–æ–≥–∏–∫–∏ –∞–≤—Ç–æ—Ä–∞)
    head->controls = default_controls;
}

//------------------------------------------------------
// –î–≤–∏–∂–µ–Ω–∏–µ –≥–æ–ª–æ–≤—ã –∑–º–µ–π–∫–∏ (go)
//------------------------------------------------------
/*
–§—É–Ω–∫—Ü–∏—è go:
- —Å—Ç–∏—Ä–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –≥–æ–ª–æ–≤—ã
- –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã x,y
- —Ä–µ–∞–ª–∏–∑—É–µ—Ç "—Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–µ" –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ –∫—Ä–∞—è–º –æ–∫–Ω–∞ (–≤—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—É ‚Äî
  –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã)
*/
void go(struct snake_t *head)
{
    char ch = '@';      // –°–∏–º–≤–æ–ª, –∫–æ—Ç–æ—Ä—ã–º —Ä–∏—Å—É–µ–º –≥–æ–ª–æ–≤—É
    int max_x = 0, max_y = 0;

    // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –æ–∫–Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ (–∫–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤)
    getmaxyx(stdscr, max_y, max_x);

    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –≥–æ–ª–æ–≤—ã (–ø–∏—à–µ–º –ø—Ä–æ–±–µ–ª)
    mvprintw(head->y, head->x, " ");

    switch (head->direction)
    {
        case LEFT:
            // –ï—Å–ª–∏ —É—Ö–æ–¥–∏–º –∑–∞ –ª–µ–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≥–æ–ª–æ–≤—É –Ω–∞ –ø—Ä–∞–≤—É—é
            if (head->x <= 0)
                head->x = max_x;
            mvprintw(head->y, --(head->x), "%c", ch);
            break;

        case RIGHT:
            // –ï—Å–ª–∏ —É—Ö–æ–¥–∏–º –∑–∞ –ø—Ä–∞–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≤–ª–µ–≤–æ
            if (head->x >= max_x)
                head->x = 0;
            mvprintw(head->y, ++(head->x), "%c", ch);
            break;

        case UP:
            // –ï—Å–ª–∏ —É—Ö–æ–¥–∏–º –∑–∞ –≤–µ—Ä—Ö–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≤–Ω–∏–∑
            if (head->y <= 0)
                head->y = max_y;
            mvprintw(--(head->y), head->x, "%c", ch);
            break;

        case DOWN:
            // –ï—Å–ª–∏ —É—Ö–æ–¥–∏–º –∑–∞ –Ω–∏–∂–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≤–≤–µ—Ä—Ö
            if (head->y >= max_y)
                head->y = 0;
            mvprintw(++(head->y), head->x, "%c", ch);
            break;

        default:
            break;
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —ç–∫—Ä–∞–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
    refresh();
}

//------------------------------------------------------
// –î–≤–∏–∂–µ–Ω–∏–µ —Ö–≤–æ—Å—Ç–∞ –∑–º–µ–π–∫–∏ (goTail)
//------------------------------------------------------
/*
–õ–æ–≥–∏–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è —Ö–≤–æ—Å—Ç–∞:
- –∫–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç "–ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è" –Ω–∞ –ø–æ–∑–∏—Ü–∏—é –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
- –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç —Ö–≤–æ—Å—Ç–∞ (tail[0]) —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ–ª–æ–≤—ã
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–ª–ª—é–∑–∏—è, —á—Ç–æ —Ö–≤–æ—Å—Ç —Ç—è–Ω–µ—Ç—Å—è –∑–∞ –≥–æ–ª–æ–≤–æ–π.
*/
void goTail(struct snake_t *head)
{
    char ch = '*';  // –°–∏–º–≤–æ–ª, –∫–æ—Ç–æ—Ä—ã–º —Ä–∏—Å—É–µ–º —Ö–≤–æ—Å—Ç

    // –°—Ç–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç —Ö–≤–æ—Å—Ç–∞ (–æ–Ω "–æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è" –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏)
    mvprintw(head->tail[head->tsize - 1].y,
             head->tail[head->tsize - 1].x, " ");

    // –°–¥–≤–∏–≥–∞–µ–º —Ö–≤–æ—Å—Ç —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ: –∫–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
    for (size_t i = head->tsize - 1; i > 0; i--)
    {
        head->tail[i] = head->tail[i - 1];

        // –†–∏—Å—É–µ–º —Å–µ–≥–º–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ (0,0) (—á—Ç–æ–±—ã –Ω–µ —Ä–∏—Å–æ–≤–∞—Ç—å "–º—É—Å–æ—Ä")
        if (head->tail[i].y || head->tail[i].x)
            mvprintw(head->tail[i].y, head->tail[i].x, "%c", ch);
    }

    // –ü–µ—Ä–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç —Ö–≤–æ—Å—Ç–∞ "–ø—Ä–∏–ª–∏–ø–∞–µ—Ç" –∫ –≥–æ–ª–æ–≤–µ ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –µ—ë —Ç–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    head->tail[0].x = head->x;
    head->tail[0].y = head->y;
}

//------------------------------------------------------
// –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è (changeDirection)
//------------------------------------------------------
/*
–§—É–Ω–∫—Ü–∏—è changeDirection:
–ø–æ –∫–æ–¥—É –Ω–∞–∂–∞—Ç–æ–π –∫–ª–∞–≤–∏—à–∏ (key) –æ–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ snake->direction.
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–¥—ã –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã controls —É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–º–µ–π–∫–∏.
*/
void changeDirection(snake_t* snake, const int32_t key)
{
    if (key == snake->controls.down)
        snake->direction = DOWN;
    else if (key == snake->controls.up)
        snake->direction = UP;
    else if (key == snake->controls.right)
        snake->direction = RIGHT;
    else if (key == snake->controls.left)
        snake->direction = LEFT;
}

//------------------------------------------------------
// –§—É–Ω–∫—Ü–∏—è main ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É / –∏–≥—Ä—É
//------------------------------------------------------
int main()
{
    /*
    –í main:
    - –≤—ã–¥–µ–ª—è–µ–º –ø–∞–º—è—Ç—å –ø–æ–¥ –∑–º–µ–π–∫—É
    - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –µ—ë
    - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã ncurses
    - –∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –¥–æ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏ F10 (STOP_GAME)
    */

    // –í—ã–¥–µ–ª—è–µ–º –ø–∞–º—è—Ç—å –ø–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—É snake_t
    snake_t* snake = (snake_t*) malloc(sizeof(snake_t));

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–º–µ–π–∫—É: –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ö–≤–æ—Å—Ç–∞ –∏ —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ–ª–æ–≤—ã
    initSnake(snake, START_TAIL_SIZE, 10, 10);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º ncurses
    initscr();
    keypad(stdscr, TRUE);   // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–ª–∞–≤–∏—à –∏ —Å—Ç—Ä–µ–ª–æ–∫
    raw();                  // –û—Ç–∫–ª—é—á–∞–µ–º line buffering (—Å–∏–º–≤–æ–ª –ø–æ–ø–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É)
    noecho();               // –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤–≤–æ–¥–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    curs_set(FALSE);        // –°–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä

    // –í—ã–≤–æ–¥–∏–º –ø–æ–¥—Å–∫–∞–∑–∫—É –≤ –≤–µ—Ä—Ö–Ω–µ–π —Å—Ç—Ä–æ–∫–µ
    mvprintw(0, 0, "Use arrows for control. Press 'F10' for EXIT");

    // –ù–µ –∂–¥—ë–º –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ ‚Äî —Ç–∞–π–º–∞—É—Ç 0 (–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π getch)
    timeout(0);

    int key_pressed = 0;

    // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª: –ø–æ–∫–∞ –Ω–µ –Ω–∞–∂–∞–ª–∏ –∫–ª–∞–≤–∏—à—É –≤—ã—Ö–æ–¥–∞ (F10)
    while (key_pressed != STOP_GAME)
    {
        // –°—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞–∂–∞—Ç—É—é –∫–ª–∞–≤–∏—à—É (–º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å ERR, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–∂–∞—Ç–æ)
        key_pressed = getch();

        // –î–≤–∏–≥–∞–µ–º –≥–æ–ª–æ–≤—É
        go(snake);

        // –î–≤–∏–≥–∞–µ–º —Ö–≤–æ—Å—Ç –≤—Å–ª–µ–¥ –∑–∞ –≥–æ–ª–æ–≤–æ–π
        goTail(snake);

        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏ (—Å–∫–æ—Ä–æ—Å—Ç—å –∑–º–µ–π–∫–∏)
        timeout(100);

        // –ú–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–∂–∞—Ç–æ–π –∫–ª–∞–≤–∏—à–∏
        changeDirection(snake, key_pressed);
    }

    // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å, –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –ø–æ–¥ —Ö–≤–æ—Å—Ç –∏ —Å–∞–º—É –∑–º–µ–π–∫—É
    free(snake->tail);
    free(snake);

    // –ó–∞–≤–µ—Ä—à–∞–µ–º —Ä–µ–∂–∏–º ncurses –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –æ–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    endwin();

    return 0;   // –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
}