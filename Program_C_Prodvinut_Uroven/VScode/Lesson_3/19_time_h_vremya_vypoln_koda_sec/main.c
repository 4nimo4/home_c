/*
//------------------------------------------------------
// Пример измерения времени выполнения кода с помощью time() и difftime()
//------------------------------------------------------
time() даёт текущее время в секундах (количество секунд с 1.1.1970 UTC),
// a difftime() аккуратно считает разницу между двумя значениями time_t и
// возвращает результат типа double (в секундах).
*/

#include <stdio.h>
#include <time.h>   // time, time_t, difftime

// Функция, которую "долго" выполняем (просто цикл-заглушка)
void do_work(void)
{
    // volatile говорит компилятору: не оптимизируй эту переменную и не выкидывай цикл,
    // даже если результат sum нигде не используется. Это важно, чтобы цикл реально
    // выполнялся и занимал время.
    volatile long long sum = 0;

    // Большой цикл, чтобы занять процессор на заметное время
    for (long long i = 0; i < 500000000; ++i) {
        sum += i;
    }
}

int main(void)
{
    // Фиксируем время начала измерения.
    // time(NULL) возвращает текущее время типа time_t.
    time_t start = time(NULL);
    if (start == (time_t)-1)   // по стандарту (time_t)-1 может означать ошибку
    {
        perror("time start");  // выводим сообщение об ошибке в stderr
        return 1;              // завершаем программу с кодом ошибки
    }

    // Выполняем "работу", которую хотим замерить по времени.
    do_work();

    // Фиксируем время окончания.
    time_t end = time(NULL);
    if (end == (time_t)-1)
    {
        perror("time end");
        return 1;
    }

    // Вычисляем разницу во времени:
    // difftime(end, start) возвращает (end - start) в виде double (в секундах).
    // Используем difftime, а не прямое вычитание, потому что тип time_t может
    // быть не просто целым, и difftime обрабатывает это корректно.
    double elapsed = difftime(end, start);

    // Выводим затраченное время. "%.0f" — без дробной части (целые секунды).
    printf("Elapsed time: %.0f seconds\n", elapsed);

    return 0;   // Успешное завершение программы
}