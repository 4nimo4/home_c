/*
//------------------------------------------------------
// –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ locale.h –∏ wchar.h
//------------------------------------------------------
locale.h ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —è–∑—ã–∫–∞
–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –°, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–¥–∞—á,
—Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π.
üîè –§—É–Ω–∫—Ü–∏—è setlocale(int category, const char* locale)
—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π —è–∑—ã–∫–æ–≤–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–ª–∏
–µ–≥–æ —á–∞—Å—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ C.
üîè –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Å–∏–ª–µ –∏ –≤–ª–∏—è—é—Ç –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö
—Ñ—É–Ω–∫—Ü–∏–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ C, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç –ª–æ–∫–∞–ª–∏, –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ
–≤—ã–∑–æ–≤–∞ setlocale.
üîè –ï—Å–ª–∏ locale —è–≤–ª—è–µ—Ç—Å—è –Ω—É–ª–µ–≤—ã–º —É–∫–∞–∑–∞—Ç–µ–ª–µ–º, setlocale
–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫–æ–≤–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç C, –Ω–µ –∏–∑–º–µ–Ω—è—è –µ–≥–æ.
*/

#include <stdio.h>    // printf, puts –∏ —Ç.–¥.
#include <locale.h>   // setlocale, LC_* –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
#include <inttypes.h> // —Ñ–æ—Ä–º–∞—Ç—ã/—Ç–∏–ø—ã —Ü–µ–ª—ã—Ö (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–¥–µ—Å—å, –Ω–æ —á–∞—Å—Ç–æ –ø–æ–ª–µ–∑–Ω–æ)
#include <wchar.h>    // wchar_t, wprintf, —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è wide-—Å—Ç—Ä–æ–∫ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

int main()
{
    /* –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª–∏ ----------------- setlocale —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π: LC_COLLATE - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ LC_CTYPE - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–æ–≤ (–≤ —Ç.—á. —á—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –±—É–∫–≤–æ–π), LC_MONETARY - —Ñ–æ—Ä–º–∞—Ç –¥–µ–Ω–µ–∂–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, LC_NUMERIC - –¥–µ—Å—è—Ç–∏—á–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (—Ç–æ—á–∫–∞/–∑–∞–ø—è—Ç–∞—è) –∏ —Ç.–¥. LC_TIME - —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏/–¥–∞—Ç LC_ALL - –≤—Å—ë –≤–º–µ—Å—Ç–µ

   –í—ã–∑–æ–≤ setlocale(LC_ALL, "") –æ–∑–Ω–∞—á–∞–µ—Ç: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å, –∫–æ—Ç–æ—Ä—É—é
   —Å–∏—Å—Ç–µ–º–∞/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   (LANG, LC_ALL, LC_MESSAGES, ...). –≠—Ç–æ —Å–∞–º—ã–π –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî
   –ø—Ä–æ–≥—Ä–∞–º–º–∞ ¬´–ø–æ–¥—Ö–≤–∞—Ç–∏—Ç¬ª –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

   –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:
     setlocale(LC_ALL, "ru_RU.UTF-8") ‚Äî —è–≤–Ω–æ —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ä—É—Å—Å–∫—É—é UTF-8 –ª–æ–∫–∞–ª—å,
       –Ω–æ —Ç–∞–∫–æ–π –≤—ã–∑–æ–≤ –≤–µ—Ä–Ω—ë—Ç NULL –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.
     setlocale(LC_ALL, NULL) ‚Äî –≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞–ª—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

   –í—Å–µ–≥–¥–∞ –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –µ—Å–ª–∏ NULL ‚Äî
   –ª–æ–∫–∞–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.
*/
char *res = setlocale(LC_ALL, "");
if (res == NULL) {
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É: –≤—ã–≤–µ—Å—Ç–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ,
    // –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è fallback –Ω–∞ "C" –ª–æ–∫–∞–ª—å –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É.
    fprintf(stderr, "Warning: locale not set, falling back to C locale\n");
} else {
    printf("Current locale: %s\n", res);
}

/* –®–∏—Ä–æ–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ (wchar_t)
   -------------------------
   wchar_t ‚Äî —Ç–∏–ø –¥–ª—è ¬´—à–∏—Ä–æ–∫–∏—Ö¬ª —Å–∏–º–≤–æ–ª–æ–≤. –†–∞–∑–º–µ—Ä wchar_t –∏ –µ–≥–æ —Å–µ–º–∞–Ω—Ç–∏–∫–∞
   –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:
     - –Ω–∞ Linux –æ–±—ã—á–Ω–æ wchar_t ‚Äî 4 –±–∞–π—Ç–∞ (UTF-32 –∫–æ–¥–æ–≤–∞—è –µ–¥–∏–Ω–∏—Ü–∞),
     - –Ω–∞ Windows wchar_t ‚Äî 2 –±–∞–π—Ç–∞ (UTF-16 –∫–æ–¥–æ–≤–∞—è –µ–¥–∏–Ω–∏—Ü–∞).

   L"–ü—Ä–∏–≤–µ—Ç" ‚Äî –ª–∏—Ç–µ—Ä–∞–ª wide-—Å—Ç—Ä–æ–∫–∏: –º–∞—Å—Å–∏–≤ wchar_t, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
   —à–∏—Ä–æ–∫–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏. –¢–∞–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ —É–¥–æ–±–Ω—ã, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å
   –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ ¬´—Å–∏–º–≤–æ–ª–∞–º–∏¬ª Unicode –∫–∞–∫ —Å –µ–¥–∏–Ω–∏—Ü–∞–º–∏ (–Ω–µ –±–∞–π—Ç–∞–º–∏).

   –î–ª—è –≤—ã–≤–æ–¥–∞ wide-—Å—Ç—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ wprintf –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ç–æ—Ä %ls.
   –í–∞–∂–Ω–æ: wprintf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞–ª—å (LC_CTYPE), –ø–æ—ç—Ç–æ–º—É
   –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–∫–∞–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –≤—ã–∑–æ–≤–∞ wprintf.
*/
wchar_t str1[] = L"–ü—Ä–∏–≤–µ—Ç";          // wide-—Å—Ç—Ä–æ–∫–∞ (wchar_t[])
wprintf(L"str1 = %ls\n", str1);     // –≤—ã–≤–æ–¥ wide-—Å—Ç—Ä–æ–∫–∏ (—Ñ–æ—Ä–º–∞—Ç ‚Äî wide literal L"...")

/* sizeof –Ω–∞ wide-—Å—Ç—Ä–æ–∫–µ
   ----------------------
   sizeof(str1) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö –≤—Å–µ–≥–æ –º–∞—Å—Å–∏–≤–∞ wchar_t,
   –≤–∫–ª—é—á–∞—è –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π –Ω—É–ª–µ–≤–æ–π wide-—Å–∏–º–≤–æ–ª (L'\0').
   –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ wchar_t == 4 –±–∞–π—Ç–∞ –∏ –≤ —Å—Ç—Ä–æ–∫–µ 6 —Å–∏–º–≤–æ–ª–æ–≤ + –Ω—É–ª—å,
   —Ç–æ sizeof(str1) == 7 * 4 == 28.
*/
printf("sizeof str1 = %zu\n", sizeof(str1));

/* –ú–Ω–æ–≥–æ–±–∞–π—Ç–æ–≤–∞—è (–æ–±—ã—á–Ω–∞—è) —Å—Ç—Ä–æ–∫–∞ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–µ (–æ–±—ã—á–Ω–æ UTF-8)
   ----------------------------------------------------------------
   –õ–∏—Ç–µ—Ä–∞–ª "–ü—Ä–∏–≤–µ—Ç" ‚Äî —ç—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–π—Ç–æ–≤ –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ
   —Ñ–∞–π–ª–∞ / –ª–æ–∫–∞–ª–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ (–æ–±—ã—á–Ω–æ UTF-8). –¢–∏–ø ‚Äî char[].
   –í UTF-8 –∫–∞–∂–¥—ã–π –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–π —Å–∏–º–≤–æ–ª –∑–∞–Ω–∏–º–∞–µ—Ç 2 –∏–ª–∏ 3 –±–∞–π—Ç–∞ (–≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ
   —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π 2 –±–∞–π—Ç–∞ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞–±–æ—Ä–æ–≤, —á–∞—â–µ 2-3,
   –Ω–æ –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –±—É–∫–≤ –æ–±—ã—á–Ω–æ 2 –±–∞–π—Ç–∞ –≤ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π —Å—Ç–∞—Ä–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–µ; –≤ UTF-8
   –∫–∞–∂–¥–æ–µ —Ä—É—Å—Å–∫–æ–µ –ø–∏—Å—å–º–æ –∑–∞–Ω–∏–º–∞–µ—Ç 2 –±–∞–π—Ç–∞? –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –≤ UTF-8 —Ä—É—Å—Å–∫–∏–µ
   —Å–∏–º–≤–æ–ª—ã –∑–∞–Ω–∏–º–∞—é—Ç 2 –±–∞–π—Ç–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ U+0400...U+07FF ‚Äî —Ç–æ—á–Ω–æ–µ —á–∏—Å–ª–æ
   –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏–º–≤–æ–ª–∞). –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ sizeof(str2) ‚Äî —ç—Ç–æ —á–∏—Å–ª–æ –±–∞–π—Ç,
   –∞ –Ω–µ —á–∏—Å–ª–æ —Å–∏–º–≤–æ–ª–æ–≤.
*/
char str2[] = "–ü—Ä–∏–≤–µ—Ç";
printf("str2 = %s\n", str2);
printf("sizeof str2 = %zu\n", sizeof(str2)); // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç –≤ –º–∞—Å—Å–∏–≤–µ (–≤–∫–ª—é—á–∞—è '\0')

/* –ê–Ω–≥–ª–æ—è–∑—ã—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –∑–∞–Ω–∏–º–∞–µ—Ç 1 –±–∞–π—Ç –≤ ASCII/UTF-8
   ---------------------------------------------------------------
   –î–ª—è –ª–∞—Ç–∏–Ω–∏—Ü—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä "Hello!", –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª ‚Äî –æ–¥–∏–Ω –±–∞–π—Ç,
   sizeof(str3) —Ä–∞–≤–Ω–æ —á–∏—Å–ª—É —Å–∏–º–≤–æ–ª–æ–≤ + 1 (–¥–ª—è '\0').
*/
char str3[] = "Hello!";
printf("str3 = %s\n", str3);
printf("sizeof str3 = %zu\n", sizeof(str3)); // 7 (6 —Å–∏–º–≤–æ–ª–æ–≤ + 1 –Ω—É–ª—å)

/* –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ª–æ–≤—É—à–∫–∏
   -----------------------------------
   1) –í—ã–≤–æ–¥ —à–∏—Ä–æ–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤:
      - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ wprintf —Å —à–∏—Ä–æ–∫–∏–º —Ñ–æ—Ä–º–∞—Ç–Ω—ã–º –ª–∏—Ç–µ—Ä–∞–ª–æ–º: L"format".
      - –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å printf("%S", ...) –≤ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ–º –∫–æ–¥–µ:
        %S —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (–≤ MSVC –æ–Ω–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å wide-string), –∞ –≤ glibc
        –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äî wprintf + %ls.

   2) setlocale –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
      - setlocale(LC_ALL, "") —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (LANG, LC_*).
      - –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ `locale -a`, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫–∏–µ –ª–æ–∫–∞–ª–∏
        —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Å–∏—Å—Ç–µ–º–µ. –ï—Å–ª–∏ "ru_RU.UTF-8" –Ω–µ—Ç, –≤—ã–∑–æ–≤ setlocale —Å
        —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π –≤–µ—Ä–Ω—ë—Ç NULL.
      - –ß–∞—Å—Ç–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞—Ç—å—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ª–æ–∫–∞–ª—å,
        –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "" (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å "C" –ª–æ–∫–∞–ª—å).

   3) Unicode vs –±–∞–π—Ç—ã:
      - wchar_t –æ–ø–µ—Ä–∏—Ä—É–µ—Ç ¬´—à–∏—Ä–æ–∫–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏¬ª (code points –≤ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π
        —Ñ–æ—Ä–º–µ), –∞ char[] —Å UTF-8 ‚Äî —ç—Ç–æ –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏—Ö –∫–æ–¥–æ–≤—ã–µ
        –ø—É–Ω–∫—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω–µ. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Ç–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–≤–æ–ª—ã
        –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ (mbrtowc / mbrlen) –∏–ª–∏
        —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (icu, libunistring –∏ —Ç.–ø.).

   4) –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
      - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ UTF-8 (–µ—Å–ª–∏ –≤—ã –ø–∏—à–µ—Ç–µ
        –≤ –Ω—ë–º –∫–∏—Ä–∏–ª–ª–∏—Ü—É). –ò–Ω–∞—á–µ –ª–∏—Ç–µ—Ä–∞–ª—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –±–∞–π—Ç—ã.

   5) –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –º—É–ª—å—Ç–∏–±–∞–π—Ç–æ–≤—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏:
      - –í—ã –º–æ–∂–µ—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É char* (UTF-8) –∏ wchar_t* –ø—Ä–∏ –ø–æ–º–æ—â–∏
        mbrtowc / mbrlen / mbstowcs / wcstombs –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏–∑ iconv/ICU.
*/

return 0;
}
/*
--------------------------------------------------------------------------
// –ù–∞ Linux –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç "ru_RU.UTF-8" –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ "". 
char* res = setlocale(LC_ALL, ""); —Ç.–µ. –Ω–∞ Linux –º–æ–∂–Ω–æ –∏ —Ç–∞–∫ –∏ —Ç–∞–∫ –ø–∏—Å–∞—Ç—å 
char* res = setlocale(LC_ALL, "ru_RU.UTF-8"); ?
---------------------------------------------------------------------------
–ö–æ—Ä–æ—Ç–∫–æ: –¥–∞ ‚Äî –º–æ–∂–Ω–æ, –Ω–æ —Å –æ–≥–æ–≤–æ—Ä–∫–∞–º–∏.
setlocale(LC_ALL, "") ‚Äî –≥–æ–≤–æ—Ä–∏—Ç: ¬´—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å —Å–æ–≥–ª–∞—Å–Ω–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è 
(LANG, LC_ALL, LC_* –∏ —Ç.–¥.)¬ª. –≠—Ç–æ –Ω–∞–∏–±–æ–ª–µ–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã–π –∏ –≥–∏–±–∫–∏–π —Å–ø–æ—Å–æ–±: 
–ø—Ä–æ–≥—Ä–∞–º–º–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –ª–æ–∫–∞–ª—å, –∫–æ—Ç–æ—Ä—É—é –Ω–∞—Å—Ç—Ä–æ–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 
–∏–ª–∏ —Å–∏—Å—Ç–µ–º–∞.

setlocale(LC_ALL, "ru_RU.UTF-8") ‚Äî —è–≤–Ω–æ –ø—Ä–æ—Å–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä—É—Å—Å–∫—É—é –ª–æ–∫–∞–ª—å 
—Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF‚Äë8. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ —Ç–∞–∫–∞—è –ª–æ–∫–∞–ª—å —Ä–µ–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ 
(—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞).

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã:
–ò—Å–ø–æ–ª—å–∑—É–π "" –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –º–µ–Ω—å—à–µ –ø—Ä–æ–±–ª–µ–º –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö,
–ø–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä—É—Å—Å–∫–∞—è –ª–æ–∫–∞–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ç–µ—Å—Ç–æ–≤), 
–º–æ–∂–Ω–æ –ø—ã—Ç–∞—Ç—å—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å "ru_RU.UTF-8", –Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

char *res = setlocale(LC_ALL, "ru_RU.UTF-8");
if (res == NULL) {
    // –ª–æ–∫–∞–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞/–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å fallback
    res = setlocale(LC_ALL, "");
    if (res == NULL) {
        fprintf(stderr, "Cannot set locale\n");
        // –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –¥–∞–ª—å—à–µ –≤ "C" –ª–æ–∫–∞–ª–∏ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å
    }
}
printf("Current locale: %s\n", res);

–ö–∞–∫ —É–∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ –ª–æ–∫–∞–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Å–∏—Å—Ç–µ–º–µ:
–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: locale -a
–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∂–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–æ–∫–∞–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, ru_RU.utf8 –∏–ª–∏ ru_RU.UTF-8). 
–ù–∞–∑–≤–∞–Ω–∏—è –º–æ–≥—É—Ç –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è (—Ä–µ–≥–∏—Å—Ç—Ä—ã, —Ç–æ—á–∫–∞/—Ç–∏—Ä–µ, utf8 vs UTF-8).

–£—á—Ç–∏ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏:
–ù–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ Linux –ª–æ–∫–∞–ª—å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ru_RU.UTF-8 –∏–ª–∏ ru_RU.utf8.
–ù–∞ Windows —Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Russian_Russia.1251" –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ 
"Russian").
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ "" –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É –º–µ–Ω–µ–µ –∑–∞–≤–∏—Å–∏–º–æ–π –æ—Ç —ç—Ç–∏—Ö –Ω—é–∞–Ω—Å–æ–≤.
–ò—Ç–æ–≥–æ: –¥–∞, –º–æ–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å "ru_RU.UTF-8", –Ω–æ –¥–µ–ª–∞–π —ç—Ç–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ 
‚Äî –ø—Ä–æ–≤–µ—Ä—è–π –≤–æ–∑–≤—Ä–∞—Ç setlocale –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –¥–µ–ª–∞–π fallback –Ω–∞ "" 
–∏–ª–∏ —Å–æ–æ–±—â–∞–π –æ–± –æ—à–∏–±–∫–µ.
*/

/*
-------------------------------------------------------------------------
–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ª–æ–∫–∞–ª–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω—É–∂–Ω—É—é
–ª–æ–∫–∞–ª—å —Å fallback.
-------------------------------------------------------------------------
#include <stdio.h>
#include <locale.h>

int main(void) {
    // –ø–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ª–æ–∫–∞–ª–∏ (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–æ—â–µ: locale -a)
    // –ó–¥–µ—Å—å –º—ã –ø—Ä–æ–±—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ª–æ–∫–∞–ª—å, –∞ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ –¥–µ–ª–∞–µ–º fallback –Ω–∞ "".
    const char *prefer = "ru_RU.UTF-8";
    char *res = setlocale(LC_ALL, prefer);
    if (res == NULL) {
        fprintf(stderr, "Warning: locale '%s' is not available, trying environment locale \"\"\n", prefer);
        res = setlocale(LC_ALL, ""); // –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
        if (res == NULL) {
            fprintf(stderr, "Warning: environment locale is not available; using C locale\n");
            setlocale(LC_ALL, "C");
            res = setlocale(LC_ALL, NULL);
        }
    }
    printf("Current locale: %s\n", res);
    return 0;
}
–ü–æ—è—Å–Ω–µ–Ω–∏—è:
–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ locale -a –ø–æ–∫–∞–∂–µ—Ç —Ç–æ—á–Ω–æ, –∫–∞–∫–∏–µ –ª–æ–∫–∞–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. –ï—Å–ª–∏ ru_RU.UTF-8
–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, setlocale –≤–µ—Ä–Ω—ë—Ç NULL. –ü—Ä–∏ –Ω–µ—É—Å–ø–µ—Ö–µ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ""
(–ª–æ–∫–∞–ª—å –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è) –∏–ª–∏ —è–≤–Ω–æ C.
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ setlocale —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Ä–æ–¥–µ wprintf, isalpha, towupper –∏ –¥—Ä. 
–±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–≥–ª–∞—Å–Ω–æ –ª–æ–∫–∞–ª–∏.
-------------------------------------------------------------------------
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É UTF‚Äë8 (char*) –∏ wchar_t*
-------------------------------------------------------------------------
#define _XOPEN_SOURCE 700
#include <stdio.h>
#include <stdlib.h>
#include <locale.h>
#include <wchar.h>
#include <errno.h>

int main(void) {
    setlocale(LC_CTYPE, ""); // –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π

    const char *mbs = "–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!";    // UTF-8 –≤ char*
    // 1) char* (multibyte) -> wchar_t* (wide)
    size_t needed = mbstowcs(NULL, mbs, 0);
    if (needed == (size_t)-1) {
        perror("mbstowcs");
        return 1;
    }
    wchar_t *wbuf = malloc((needed + 1) * sizeof(wchar_t));
    if (wbuf == NULL) { perror("malloc"); return 1; }
    mbstowcs(wbuf, mbs, needed + 1); // –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º
    wprintf(L"Converted to wchar_t*: %ls\n", wbuf);

    // 2) wchar_t* -> char* (multibyte)
    size_t need_mb = wcstombs(NULL, wbuf, 0);
    if (need_mb == (size_t)-1) {
        perror("wcstombs");
        free(wbuf);
        return 1;
    }
    char *mbbuf = malloc(need_mb + 1);
    if (mbbuf == NULL) { perror("malloc"); free(wbuf); return 1; }
    wcstombs(mbbuf, wbuf, need_mb + 1);
    printf("Converted back to multibyte: %s\n", mbbuf);

    free(wbuf);
    free(mbbuf);
    return 0;
}

–ü–æ—è—Å–Ω–µ–Ω–∏—è:
setlocale(LC_CTYPE, "") –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞, –∏–Ω–∞—á–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å, 
–∏ mbstowcs/wcstombs –≤–µ—Ä–Ω—É—Ç (size_t)-1. mbstowcs(NULL, mbs, 0) –∏
wcstombs(NULL, wbuf, 0)
–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±—É—Ñ–µ—Ä–∞ (–Ω–µ –≤—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∞—é—Ç 
—ç—Ç–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ, –Ω–æ –Ω–∞ POSIX –æ–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç).
–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ (size_t)-1 ‚Äî —ç—Ç–æ –æ—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏.
–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ç–µ–∫—É—â–µ–π LC_CTYPE –ª–æ–∫–∞–ª—å—é; –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å –Ω–µ UTF‚Äë8, 
—Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –¥—Ä—É–≥–æ–π.

-------------------------------------------------------------------------
–ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ Unicode –∫–æ–¥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ UTF‚Äë8 —Å—Ç—Ä–æ–∫–µ (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫)
-------------------------------------------------------------------------
#include <stdio.h>
#include <stdint.h>
#include <string.h>

// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å–ª–æ Unicode code points –≤ –≤–∞–ª–∏–¥–Ω–æ–π UTF-8 —Å—Ç—Ä–æ–∫–µ.
// –ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –±–∞–π—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (size_t)-1.
size_t utf8_codepoint_count(const char *s) {
    size_t count = 0;
    const unsigned char *p = (const unsigned char *)s;
    while (*p) {
        unsigned char c = *p;
        size_t advance;
        if (c < 0x80) {
            advance = 1;
        } else if ((c & 0xE0) == 0xC0) {
            // 2-byte sequence: 110xxxxx 10xxxxxx
            if ((p[1] & 0xC0) != 0x80) return (size_t)-1;
            advance = 2;
        } else if ((c & 0xF0) == 0xE0) {
            // 3-byte
            if ((p[1] & 0xC0) != 0x80 || (p[2] & 0xC0) != 0x80) return (size_t)-1;
            advance = 3;
        } else if ((c & 0xF8) == 0xF0) {
            // 4-byte
            if ((p[1] & 0xC0) != 0x80 || (p[2] & 0xC0) != 0x80 || (p[3] & 0xC0) != 0x80) return (size_t)-1;
            advance = 4;
        } else {
            // –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–π—Ç
            return (size_t)-1;
        }
        p += advance;
        count++;
    }
    return count;
}

int main(void) {
    const char *s = "–ü—Ä–∏–≤–µ—Ç"; // UTF-8
    size_t cp = utf8_codepoint_count(s);
    if (cp == (size_t)-1) {
        printf("Invalid UTF-8\n");
    } else {
        printf("UTF-8 code points: %zu, bytes: %zu\n", cp, strlen(s));
    }
    return 0;
}

–ü–æ—è—Å–Ω–µ–Ω–∏—è:

–§—É–Ω–∫—Ü–∏—è –Ω–µ –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç –∫–æ–¥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é, –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å UTF‚Äë8 –∏ 
—Å—á–∏—Ç–∞–µ—Ç —Å–∏–º–≤–æ–ª—ã (code points).
–û–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—á–∏—Ç–∞–µ—Ç —ç–º–æ–¥–∑–∏ –∏ —Å–∏–º–≤–æ–ª—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ 4-–±–∞–π—Ç–æ–≤—ã–º–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏.
–î–ª—è –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π —Ä–∞–±–æ—Ç—ã (–≥—Ä–∞—Ñ–µ–º—ã ‚Äî ¬´–≤–∏–¥–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã¬ª, –∫–æ–º–±–∏–Ω–∏—Ä—É—é—â–∏–µ –∑–Ω–∞–∫–∏ –∏ —Ç.–¥.) 
–Ω—É–∂–Ω–∞ ICU, libunistring –∏–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞; –≤ UTF‚Äë8 –æ–¥–∏–Ω code point 
–Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–≤–µ–Ω –≤–∏–¥–∏–º–æ–º—É ¬´–≥–ª–∏—Ñ—É¬ª.
*/