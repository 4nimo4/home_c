/*
//------------------------------------------------------
//   –°–∫–æ–ª—å–∑—è—â–∞—è –•–ï–® —Ñ—É–Ω–∫—Ü–∏—è
//------------------------------------------------------ 
–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–∞ —à–∞–±–ª–æ–Ω —Ç–µ–∫—Å—Ç–∞ ¬´135¬ª –∏ —Ç–µ–∫—Å—Ç ¬´2135¬ª. –°–Ω–∞—á–∞–ª–∞
–≤—ã—á–∏—Å–ª—è–µ–º —Ö–µ—à —à–∞–±–ª–æ–Ω–∞ 135 –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É:
H(135) = 10^2*1 + 10^1*3 + 10^0*5 = 135
–ó–∞—Ç–µ–º –≤—ã—á–∏—Å–ª—è–µ–º —Ö–µ—à –ø–µ—Ä–≤—ã—Ö m = 3 —Å–∏–º–≤–æ–ª–æ–≤ —Ç–µ–∫—Å—Ç–∞, —Ç. –µ. 213:
H(213) = 10^2*2 + 10^1*1 + 10^0*3 = 213
–°–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ. –¢–µ–ø–µ—Ä—å —Å–¥–≤–∏–≥–∞–µ–º –ø–æ–¥—Å—Ç—Ä–æ–∫—É, –æ—Ç–±—Ä–æ—Å–∏–≤ –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª
–ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ–∫–Ω–∞ –∏ –¥–æ–±–∞–≤–∏–≤ —Å–ª–µ–¥—É—é—â–∏–π. –ü–æ–ª—É—á–∏–ª–æ—Å—å –Ω–æ–≤–∞—è 135. –í—ã—á–∏—Å–ª—è–µ–º –¥–ª—è
–Ω–µ—ë —Ö–µ—à:
H(135) = 10^2*1 + 10^1*3 + 10^0*5 = 135
–•–µ—à–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ –Ω–∞–π–¥–µ–Ω–∞.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –ø–µ—Ä–µ–º–µ—Å—Ç–∏–≤ —Å–∫–æ–ª—å–∑—è—â—É—é –ø–æ–¥—Å—Ç—Ä–æ–∫—É, –Ω–∞–º –ø—Ä–∏—à–ª–æ—Å—å –≤—ã—á–∏—Å–ª–∏—Ç—å
–≤–µ—Å—å —Ö–µ—à 213 –∏ 135, —á—Ç–æ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏ —ç—Ç–æ–º –º—ã –≤—ã—á–∏—Å–ª–∏–ª–∏ —Ö–µ—à —Ü–µ–ª—ã—Ö
—á–∏—Å–µ–ª, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –¥–µ–π—Å—Ç–≤–∏–∏.
üè° –°–∫–æ–ª—å–∑—è—â–∞—è —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å—Ç–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å —ç—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ
–≤—ã—á–∏—Å–ª–µ–Ω–∏—è, —É–±—Ä–∞–≤ –∏–∑ –ø–æ–¥—Å—á—ë—Ç–∞ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ö–µ—à–∞ –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª
–ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∏ –¥–æ–±–∞–≤–∏–≤ –Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª.
üè° –ú—ã –º–æ–∂–µ–º –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —Ö–µ—à-–∑–Ω–∞—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ —É–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑ –ø–æ–¥—Å—á—ë—Ç–∞ —Å–∏–º–≤–æ–ª–∞,
—É–º–Ω–æ–∂–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ, —á—Ç–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
–ø–æ—Ä—è–¥–æ–∫ —Å—Ç–µ–ø–µ–Ω–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏ –¥–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
–Ω–æ–≤–æ–≥–æ —Å–∏–º–≤–æ–ª–∞.

–¢–∞–∫, –º—ã –º–æ–∂–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å —Ö–µ—à –Ω–æ–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
H = (H previous + C previous*pow strlen-1 )pow + C new
Hp - –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ö–µ—à
C prevoius - –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–∏–º–≤–æ–ª
C new - –Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª
strlen - —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–æ–∫
pow - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞
–ò—Å–ø–æ–ª—å–∑—É—è –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø—Ä–∏–º–µ—Ä —Å–¥–≤–∏–≥–∞ –æ—Ç 213 –∫ 135, –º—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π
—Ö–µ—à:
H =(213-2 *10^2)*10 +5=135
*/

#include <stdio.h> 
#include <stdint.h> 
#include <inttypes.h> // –Ω—É–∂–µ–Ω –¥–ª—è PRIu64 
#include <string.h>

// –®–∞–±–ª–æ–Ω –∏ —Ç–µ–∫—Å—Ç (–¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏–π —à–∞–±–ª–æ–Ω–∞ –≤ —Ç–µ–∫—Å—Ç–µ) 
char s[100] = "135"; 
char text[100] = "21354562135";

// –û—Å–Ω–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å—á–∏—Å–ª–µ–Ω–∏—è –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (–∑–¥–µ—Å—å —Ü–∏—Ñ—Ä—ã 0..9) 
uint64_t p = 10;

// –í—ã—á–∏—Å–ª—è–µ—Ç —á–∏—Å–ª–æ–≤–æ–π —Ö–µ—à –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –¥–ª–∏–Ω—ã len, –∏—Å–ø–æ–ª—å–∑—É—è –æ—Å–Ω–æ–≤–∞–Ω–∏–µ p. 
//–û—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –∫–∞–∫: hash = hash * p + digit –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, 
//—á—Ç–æ –≤ —Å—Ç—Ä–æ–∫–µ —Ç–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª—ã '0'..'9'.  
uint64_t getHash(char *str, size_t len) 
{ 
    uint64_t hash = 0; 
    char c; 
    for (size_t i = 0; i < len; i++) 
    { 
        c = str[i]; 
        hash *= p; // —Å–¥–≤–∏–≥ —Ä–∞–∑—Ä—è–¥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ base=p 
        hash += (c - '0'); // –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–∏—Ñ—Ä—ã 
    } 
    return hash; 
}

int main(void) 
{ 
    // ht ‚Äî –º–∞—Å—Å–∏–≤ —Ö–µ—à–µ–π –¥–ª—è –≤—Å–µ—Ö –æ–∫–æ–Ω –¥–ª–∏–Ω—ã lens –≤ —Ç–µ–∫—Å—Ç–µ 
    uint64_t ht[100] = {0}; uint64_t hs; // —Ö–µ—à —à–∞–±–ª–æ–Ω–∞ s 
    uint64_t p_pow = 1; // p^(lens-1), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ rolling-hash

    size_t lens = strlen(s);
    size_t lent = strlen(text);

    // –í—ã—á–∏—Å–ª—è–µ–º —Ö–µ—à —à–∞–±–ª–æ–Ω–∞ 
    hs = getHash(s, lens);

    // –í—ã–≤–æ–¥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    printf("%s\n", s);
    printf("%s\n", text);
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è uint64_t
    printf("s hash = %" PRIu64 "\n", hs);

    // p_pow = p^(lens-1) ‚Äî –º–Ω–æ–∂–∏—Ç–µ–ª—å —Å—Ç–∞—Ä—à–µ–≥–æ —Ä–∞–∑—Ä—è–¥–∞ –≤ –æ–∫–Ω–µ –¥–ª–∏–Ω—ã lens.
   //–ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–∫–Ω—É –º–æ–∂–Ω–æ –±—ã–ª–æ —É–±—Ä–∞—Ç—å –≤–∫–ª–∞–¥
   //—Å—Ç–∞—Ä—à–µ–π —Ü–∏—Ñ—Ä—ã (—Å–º. –Ω–∏–∂–µ).
    for (size_t i = 1; i < lens; i++)
        p_pow *= p;

    // –•–µ—à –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –æ–∫–Ω–∞ —Ç–µ–∫—Å—Ç–∞ (text[0..lens-1])
    ht[0] = getHash(&text[0], lens);
    printf("%" PRIu64 " ", ht[0]);

    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –æ–∫–Ω–∞–º —Ç–µ–∫—Å—Ç–∞ –¥–ª–∏–Ω—ã lens.
    //–§–æ—Ä–º—É–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (rolling hash), –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –∑–¥–µ—Å—å:
    // ht[i] = (ht[i-1] % p_pow) * p + value(new_digit)
    // –ò–¥–µ—è: ht[i-1] % p_pow —É–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ä—à—É—é —Ü–∏—Ñ—Ä—É –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ–∫–Ω–∞,
   //–∑–∞—Ç–µ–º —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ p —Å–¥–≤–∏–≥–∞–µ—Ç —Ä–∞–∑—Ä—è–¥—ã, –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –º–ª–∞–¥—à—É—é —Ü–∏—Ñ—Ä—É.
   //–í–∞–∂–Ω–æ: —ç—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ ht[i-1] —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —á–∏—Å—Ç–æ–π
   //–∑–∞–ø–∏—Å–∏ –≤ —Å–∏—Å—Ç–µ–º–µ base=p (—Ç.–µ. –Ω–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏–∑-–∑–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è).
    
    for (size_t i = 1; i < lent - lens + 1; i++)
    {
        ht[i] = (ht[i - 1] % p_pow) * p + (uint64_t)(text[lens + i - 1] - '0');

        // –ü—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Ö–µ—à–µ–π –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å –≤—Ö–æ–∂–¥–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞.
       //–ò–∑‚Äë–∑–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–ª–ª–∏–∑–∏–π –ø—Ä–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
       //—Å—Ä–∞–≤–Ω–∏—Ç—å –ø–æ–¥—Å—Ç—Ä–æ–∫—É —Å —à–∞–±–ª–æ–Ω–æ–º –Ω–∞–ø—Ä—è–º—É—é (strcmp). –ó–¥–µ—Å—å –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏
       //—Ç–æ–ª—å–∫–æ –ø–æ–º–µ—á–∞–µ–º '!' –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Ö–µ—à–µ–π.
        if (hs == ht[i])
            printf("!");
        printf("%" PRIu64 " ", ht[i]);
    }
    printf("\n");

    return 0;
}
