/*
//------------------------------------------------------ 
// Вычисление интеграла методом прямоугольника
//------------------------------------------------------
Метод заключается в разбиении промежутка интегрирования на
некоторое количество равных отрезков, чем больше — тем точнее будет
приближение. На каждом отрезке строим прямоугольник, одна из сторон
которого лежит на оси, а противоположная — пересекает график
подынтегральной функции. Вычисляем площадь полученной ступенчатой
фигуры, которая и будет приближённой оценкой площади.

//------------------------------------------------------ 
// Комбинированный метод
//------------------------------------------------------
Если функция на отрезке [a,b] является непрерывной, значение интеграла
можно найти по формуле:
● Формуле левых прямоугольников:

a ∫ b f(x) ≈ f(a)(b-a)

● Формуле правых прямоугольников:

a ∫ b f(x) ≈ f(b)(b-a)

● Формула средних прямоугольников:

a ∫ b f(x) ≈ f(a/2 + b/2)(b-a)

Формула для сетки можно описать следующим образом:
xi =xl +ih , где h = (xr - xl) / n  это шаг сетки

Соответствующие формулы прямоугольников будут выглядеть следующим
образом:

Формула левых прямоугольников:

a ∫ b f(x) ≈ h(f0 + f1 + .... fn-1)

Формула правых прямоугольников:

a ∫ b f(x) ≈ h(f1 + f2 + .... fn)

Формула средних прямоугольников:

a ∫ b f(x) ≈ h(f0/2 + f1 + .... fn-1 + fn/2)
*/

#include <stdio.h>    // стандартный ввод-вывод (printf и др.)
#include <math.h>     // математические функции (здесь фактически не используются)

#define ACCURACY 1000 // Количество разбиений интервала (число прямоугольников)

typedef float(*function)(float);
// Тип function — указатель на функцию вида: float f(float)


//------------------------------------------------------ 
// Интегрируемая функция f(x)
// В комментариях выше указаны интервалы для поиска корней:
// (-2, -1.5) (-1.5, -1) (-1, -0.5) (-0.5, 0)
// Здесь же она используется для интегрирования.
// f(x) = 8x^4 + 32x^3 + 40x^2 + 16x + 1
//------------------------------------------------------
float f(float x) 
{
    return 8*x*x*x*x + 32*x*x*x + 40*x*x + 16*x + 1;
}

//------------------------------------------------------ 
// Тестовая функция для проверки метода интегрирования.
// Возвращает константу 2 (функция y = 2).
// Интеграл по [0, 2] от 2 dx = 2 * 2 = 4 — это площадь прямоугольника
// шириной 2 и высотой 2.
//------------------------------------------------------
float testf(float x)
{
    return 2;
}

//------------------------------------------------------ 
// Вычисление определённого интеграла методом прямоугольников
// (метод левых прямоугольников).
//
// xl, xr — левый и правый пределы интегрирования
// n      — количество разбиений (прямоугольников)
// f      — функция, которую интегрируем
//
// Идея: разбить [xl, xr] на n равных отрезков длиной h,
// и посчитать сумму площадей прямоугольников высоты f(x_i).
//------------------------------------------------------
float calcIntegralSquare(float xl, float xr, size_t n, function f) 
{
    float sum = 0.0f;           // накопленная сумма значений f(x)
    float h = (xr - xl) / n;    // ширина одного прямоугольника

    // Цикл по всем n прямоугольникам
    for (size_t i = 0; i < n; i++) 
    {
        sum += f(xl);  // берём значение функции в левой точке текущего отрезка
        xl += h;       // переходим к следующему отрезку
    }

    // Общий интеграл ≈ сумма высот * ширина прямоугольника
    return sum * h;
}

int main(void) 
{
    // 1. Тест: интеграл от testf(x) = 2 на интервале [0, 2].
    // Ожидаемый результат: 4.0
    printf("calcIntegralSquare integral %f\n",
           calcIntegralSquare(0, 2, ACCURACY, testf));
    // Результат:
    // calcIntegralSquare integral 4.000000

    /*
        Тестовая функция:

        float testf(float x)
        {
            return 2;
        }

        Даёт площадь прямоугольника 2×2 = 4.
    */

    // 2. Интеграл исходной функции f(x) на интервале [-1.382683, -0.617316].
    // Комментарий говорит, что это площадь "половины лепестка синусоиды
    // выше оси абсцисс" — то есть некоторой положительной области под графиком.
    printf("calcIntegralSquare = %f\n",
           calcIntegralSquare(-1.382683, -0.617316, ACCURACY, f));
    // Пример результата:
    // calcIntegralSquare = 0.492744

    return 0;
}